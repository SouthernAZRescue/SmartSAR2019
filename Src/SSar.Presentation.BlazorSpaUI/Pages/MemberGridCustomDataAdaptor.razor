
@using System.Data
@using Newtonsoft.Json
@using SSar.BC.MemberMgmt.Application
@using SSar.Presentation.BlazorSpaUI.Services
@using Syncfusion.Blazor;
@using Syncfusion.Blazor.Data;
@inject ApiClient apiClient

@inherits DataAdaptor<MemberDto>

@code {
    [Parameter]
    [JsonIgnore]
    public RenderFragment ChildContent { get; set; }

    public override async Task<object> ReadAsync(DataManagerRequest dm, string key = null)
    {
        IEnumerable<MemberDto> memberList = await apiClient.GetAll();

        // Searching
        if (dm.Search != null && dm.Search.Count > 0)
        {
            memberList = DataOperations.PerformSearching(memberList, dm.Search);
        }

        // Sorting
        if (dm.Sorted != null && dm.Sorted.Count > 0)
        {
            memberList = DataOperations.PerformSorting(memberList, dm.Sorted);
        }

        // Filtering
        if (dm.Where != null && dm.Where.Count > 0)
        {
            memberList = DataOperations.PerformFiltering(memberList, dm.Where, dm.Where[0].Operator);
        }

        // Paging
        int count = memberList.Cast<MemberDto>().Count();

        if (dm.Skip != 0)
        {
            memberList = DataOperations.PerformSkip(memberList, dm.Skip);
        }

        if (dm.Take != 0)
        {
            memberList = DataOperations.PerformTake(memberList, dm.Take);
        }

        return dm.RequiresCounts ? new DataResult() {Result = memberList, Count = count} : (object) memberList;
    }
}
